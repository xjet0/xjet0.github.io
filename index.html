<!DOCTYPE html><html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JetX‚Äëstyle Crash Demo (√©quilibr√©)</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0b1020;color:#e9edff;display:flex;align-items:center;justify-content:center;height:100vh}
    .app{width:100%;max-width:600px;text-align:center}
    .arena{background:#121832;padding:20px;border-radius:12px;margin-bottom:20px;position:relative;height:200px}
    #mult{font-size:40px;font-weight:bold}
    .status{margin-top:10px}
    .controls{display:flex;justify-content:center;gap:10px;margin-top:10px}
    button{padding:10px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:bold}
    .primary{background:#4b6bff;color:#fff}
    .good{background:#22c55e;color:#fff}
    .ghost{background:#374151;color:#fff}
    .history{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px;justify-content:center}
    .chip{padding:4px 8px;border-radius:999px;font-size:13px}
    .g{background:#064e3b;color:#4ade80}
    .r{background:#581c1c;color:#fb7185}
  </style>
</head>
<body>
  <div class="app">
    <div class="arena">
      <div id="mult">1.00√ó</div>
      <div class="status" id="status">Pr√™t</div>
    </div>
    <div>
      Solde¬†: <span id="balance">1000</span> ‚ö™Ô∏é
    </div>
    <div class="controls">
      <input id="stake" type="number" value="50" min="1" style="width:80px" />
      <button class="primary" id="startBtn">‚ñ∂Ô∏è Lancer</button>
      <button class="good" id="cashBtn" disabled>üí∏ Retirer</button>
      <button class="ghost" id="resetBtn">‚Ü∫ Reset</button>
    </div>
    <div class="history" id="history"></div>
  </div>  <script>
    const multEl = document.getElementById('mult');
    const statusEl = document.getElementById('status');
    const stakeEl = document.getElementById('stake');
    const startBtn = document.getElementById('startBtn');
    const cashBtn = document.getElementById('cashBtn');
    const resetBtn = document.getElementById('resetBtn');
    const balanceEl = document.getElementById('balance');
    const historyEl = document.getElementById('history');

    let balance = 1000; const BASE_BALANCE = balance;
    let inRound = false, crashed = false, cashed = false;
    let currentMult = 1.0;
    let crashPoint = 0;
    let raf;

    // Nouvel algo: plusieurs petits gains cons√©cutifs, puis un gros crash pour pi√©ger l'user
    // --- Logic am√©lior√©e: √©tat de march√© avec petites victoires, puis perte marqu√©e ---
    let state = 'SAFE';
    let safeStreak = 0;
    let plannedKillIn = 3; // nombre de rounds avant un kill
    const PROFIT_CAP = 150; // si (balance - BASE_BALANCE) d√©passe, on resserre

    function rand(a,b){ return a + Math.random()*(b-a); }

    function nextCrashPoint(){
      const profit = balance - BASE_BALANCE;

      // Profit guard: trop de b√©n√©fices => crashs serr√©s pendant un moment
      if (profit > PROFIT_CAP){
        state = 'KILL';
        plannedKillIn = 1; // kill imm√©diat
      }

      // Transition simple d'√©tat
      if (state === 'SAFE'){
        safeStreak++;
        // Rounds faciles: fen√™tre 1.20x‚Äì2.10x
        const c = rand(1.20, 2.10);
        if (safeStreak >= plannedKillIn){
          state = 'KILL';
        }
        return c;
      }

      if (state === 'KILL'){
        // Kill round: bust quasi instantan√© 1.00x‚Äì1.10x
        const c = rand(1.00, 1.10);
        state = 'RECOVERY';
        safeStreak = 0;
        // Apr√®s un kill, on replanifie un nouveau cycle 2‚Äì4 safe
        plannedKillIn = Math.floor(rand(2, 4.99));
        return c;
      }

      // RECOVERY / NEUTRAL: un peu plus haut pour redonner confiance
      // 1.40x‚Äì2.80x, puis retour √† SAFE
      if (state === 'RECOVERY'){
        const c = rand(1.40, 2.80);
        state = 'SAFE';
        return c;
      }

      // Fallback
      return rand(1.20, 2.00);
    } else {
        // Autres tours: crash plus haut (user peut souvent gagner)
        return 2 + Math.random()*4; // crash entre 2√ó et 6√ó
      }
    }

    function setMult(x){
      currentMult = x;
      multEl.textContent = x.toFixed(2)+'√ó';
    }

    function pushHistory(x){
      const chip=document.createElement('div');
      chip.className='chip '+(x>=2?'g':'r');
      chip.textContent=x.toFixed(2)+'√ó';
      historyEl.prepend(chip);
      while(historyEl.children.length>10)historyEl.removeChild(historyEl.lastChild);
    }

    function startRound(){
      if(inRound)return;
      const stake=Number(stakeEl.value)||0;
      if(stake>balance){alert('Solde insuffisant');return;}
      balance-=stake;updateBalance();
      inRound=true;crashed=false;cashed=false;
      crashPoint=nextCrashPoint();
      setMult(1.0);
      statusEl.textContent='En cours‚Ä¶';
      startBtn.disabled=true;cashBtn.disabled=false;
      let start=performance.now();
      function loop(){
        raf=requestAnimationFrame(loop);
        const t=(performance.now()-start)/1000;
        // croissance exponentielle plus nerveuse sans d√©passer trop vite
        const m=Math.exp(0.9*t); // croissance
        setMult(m);
        if(m>=crashPoint){onCrash();}
      }
      loop();
    }

    function onCrash(){
      if(!inRound)return;
      cancelAnimationFrame(raf);
      inRound=false;crashed=true;
      setMult(crashPoint);
      statusEl.textContent='üí• CRASH';
      pushHistory(crashPoint);
      startBtn.disabled=false;cashBtn.disabled=true;
    }

    function doCashout(){
      if(!inRound||cashed||crashed)return;
      cashed=true;
      const stake=Number(stakeEl.value)||0;
      const win=stake*currentMult*0.99; // rake 1%
      balance+=Math.floor(win);
      updateBalance();
      statusEl.textContent='‚úÖ Retir√© √† '+currentMult.toFixed(2)+'√ó';
      cashBtn.disabled=true;
    }

    function reset(){
      if(inRound)cancelAnimationFrame(raf);
      inRound=false;cashed=false;crashed=false;
      setMult(1.0);statusEl.textContent='Pr√™t';
      startBtn.disabled=false;cashBtn.disabled=true;
    }

    function updateBalance(){balanceEl.textContent=balance;}

    startBtn.onclick=startRound;
    cashBtn.onclick=doCashout;
    resetBtn.onclick=reset;
  </script></body>
</html>
